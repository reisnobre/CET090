DROP TABLE PAISES, UF, CIDADE, AREAS, CEP, ENDERECOS, TELEFONES, EMPREGADOS, TIPOTELEFONES, DEPARTAMENTOS, DEPENDENTES, PROJETOS, EMPREGADOS_PROJETOS, CIDADES_PROJETOS cascade;

CREATE TABLE PAISES (
	COD varchar(4) unique, 
	ID numeric(4),
	NOM varchar(30)
);
ALTER TABLE PAISES
ADD constraint PAISES_COD primary key(ID);

CREATE TABLE UF (
	ID numeric(4),
	UF varchar(2) unique,
	NOM varchar(30)
);
ALTER TABLE UF 
ADD constraint UF_ID primary key(ID);

CREATE TABLE CIDADE (
	COD numeric,
	NOM varchar(100),
	UF_UF varchar(2) 
);
ALTER TABLE CIDADE 
ADD constraint CIDADE_COD primary key(COD);

CREATE TABLE CEP (
	LOG varchar,
	BAI varchar,
	CEP numeric,
	CID_COD numeric
);
ALTER TABLE CEP
ADD constraint CEP_COD primary key(CEP);

CREATE TABLE AREAS (
	ID numeric(2),
	DES varchar(30),
	DDD numeric(2),
	PAIS_COD numeric(4)
);
ALTER TABLE AREAS
ADD constraint DDD_ID primary key(DDD);

CREATE TABLE DEPARTAMENTOS (
	COD numeric, 
	DES varchar(150), 
	EMP_COD numeric NULL
);
ALTER TABLE DEPARTAMENTOS 
ADD constraint DEPARTAMENTO_COD primary key(COD);

CREATE TABLE EMPREGADOS (
	RG numeric,
	NOM varchar(50),
	CPT varchar(50),
	SEX varchar(2),
	COD numeric,
	CPF varchar(11),
	EMP_COD numeric NULL,
	DPT_COD numeric
);
ALTER TABLE EMPREGADOS 
ADD constraint EMPREGADOS_COD primary key(COD),
ADD constraint CHECK_SEX check (SEX in ('M', 'F')),
ADD constraint EMP_COD_FK foreign key(EMP_COD) references EMPREGADOS(COD);

CREATE TABLE DEPENDENTES (
	DTN date,
	NOM varchar(50),
	SEX varchar(1),
	EMP_COD numeric
);
ALTER TABLE DEPENDENTES 
ADD constraint CHECK_SEX check (SEX in ('M', 'F')),
ADD constraint NOM primary key(NOM);

CREATE TABLE ENDERECOS (
	COM varchar,
	NUM numeric,
	COD numeric,
	EMP_COD numeric,
	CEP_COD numeric
);
ALTER TABLE ENDERECOS
ADD constraint END_COD primary key(COD);


CREATE TABLE TIPOTELEFONES (
	COD numeric,
	DES varchar(30)
);
ALTER TABLE TIPOTELEFONES 
ADD constraint TIPO_TELEFONES_COD primary key(COD);

CREATE TABLE TELEFONES (
	ID numeric(2),
	NUM numeric(8),
	EMP_COD numeric,
	TTEL_COD numeric(2),
	AREA_DDD numeric(2) 
);
ALTER TABLE TELEFONES 
ADD constraint TELEFONES_ID primary key(ID);

CREATE TABLE PROJETOS (
	DES varchar(150),
	RES varchar,
	COD numeric,
	DPT_COD numeric
);
ALTER TABLE PROJETOS
ADD constraint PRJ_COD primary key (COD);

CREATE TABLE EMPREGADOS_PROJETOS(
	EMP_COD numeric,
	PRJ_COD numeric
);


CREATE TABLE CIDADES_PROJETOS (
	CID_COD numeric,
	PRJ_COD numeric
);


-- ALTER TABLES

ALTER TABLE CIDADE
ADD constraint UF_UF_FK foreign key (UF_UF) references UF(UF);

ALTER TABLE CEP
ADD constraint CID_COD_FK foreign key (CID_COD) references CIDADE(COD);

ALTER TABLE ENDERECOS
ADD constraint EMP_COD_FK foreign key (EMP_COD) references EMPREGADOS(COD),
ADD constraint CEP_COD_FK foreign key (CEP_COD) references CEP(CEP);

ALTER TABLE TELEFONES
ADD constraint TTEL_COD_FK foreign key (TTEL_COD) references TIPOTELEFONES(COD),
ADD constraint EMP_COD_FK foreign key (EMP_COD) references EMPREGADOS(COD),
ADD constraint AREA_DDD_FK foreign key (AREA_DDD) references AREAS(DDD);

ALTER TABLE EMPREGADOS_PROJETOS
ADD constraint EMP_COD_FK foreign key (EMP_COD) references EMPREGADOS(COD),
ADD constraint PRJ_COD_FK foreign key (PRJ_COD) references PROJETOS(COD);

ALTER TABLE DEPARTAMENTOS
ADD constraint EMP_COD_FK foreign key(EMP_COD) references EMPREGADOS(COD);

ALTER TABLE PROJETOS
ADD constraint DPT_COD_FK foreign key (DPT_COD) references DEPARTAMENTOS(COD);

ALTER TABLE CIDADES_PROJETOS
ADD constraint CID_COD_FK foreign key (CID_COD) references CIDADE(COD),
ADD constraint PRJ_COD_FK foreign key (PRJ_COD) references PROJETOS(COD);


-- INSERTS

BEGIN;
INSERT INTO paises (COD, ID, NOM) VALUES ('AND',20,'Andorra');
INSERT INTO paises (COD, ID, NOM) VALUES ('ARE',784,'Emiratos Árabes Unidos');
INSERT INTO paises (COD, ID, NOM) VALUES ('AFG',4,'Afeganistão');
INSERT INTO paises (COD, ID, NOM) VALUES ('ATG',28,'Antigua e Barbuda');
INSERT INTO paises (COD, ID, NOM) VALUES ('AIA',660,'Anguilla');
INSERT INTO paises (COD, ID, NOM) VALUES ('ALB',8,'Albânia');
INSERT INTO paises (COD, ID, NOM) VALUES ('ARM',51,'Arménia');
INSERT INTO paises (COD, ID, NOM) VALUES ('ANT',530,'Antilhas Holandesas');
INSERT INTO paises (COD, ID, NOM) VALUES ('AGO',24,'Angola');
INSERT INTO paises (COD, ID, NOM) VALUES ('ATA',10,'Antárctida');
INSERT INTO paises (COD, ID, NOM) VALUES ('ARG',32,'Argentina');
INSERT INTO paises (COD, ID, NOM) VALUES ('ASM',16,'Samoa Americana');
INSERT INTO paises (COD, ID, NOM) VALUES ('AUT',40,'Áustria');
INSERT INTO paises (COD, ID, NOM) VALUES ('AUS',36,'Austrália');
INSERT INTO paises (COD, ID, NOM) VALUES ('ABW',533,'Aruba');
COMMIT;

BEGIN;
INSERT INTO UF (ID, UF, NOM) (SELECT * FROM state ORDER BY random() limit 10);
COMMIT;

BEGIN;
INSERT INTO CIDADE (COD, UF_UF, NOM) (SELECT city_codigo, uf, city_descricao FROM uf INNER JOIN city on (uf.id = city.state_codigo));
COMMIT;

BEGIN;
INSERT INTO CEP (
	SELECT address_logradouro, neighborhood_descricao, address_cep::NUMERIC, city_codigo FROM neighborhood 
	INNER JOIN cidade ON (neighborhood.city_codigo = cidade.cod) 
	INNER JOIN address ON (neighborhood.neighborhood_codigo = address.neighborhood_codigo) limit 100
);
COMMIT;

BEGIN;
	INSERT INTO AREAS VALUES (1, 'Area 51', '73', 20);
	INSERT INTO AREAS VALUES (2, 'Area 52', '21', 533);
	INSERT INTO AREAS VALUES (3, 'Area 53', '11', 36);
COMMIT;


BEGIN;
	INSERT INTO DEPARTAMENTOS VALUES (1, 'DCET');
	INSERT INTO DEPARTAMENTOS VALUES (2, 'DCAA');
	INSERT INTO DEPARTAMENTOS VALUES (3, 'DCU');
COMMIT;

BEGIN;
	INSERT INTO EMPREGADOS (RG, NOM, CPT, SEX, COD, CPF, DPT_COD) 
	VALUES (
		1525822680, 'Eduardo Reis Nobre', 'CPT 1', 'M', 1, 05158725580,
		(SELECT COD FROM DEPARTAMENTOS ORDER BY random() limit 1)
	);
	INSERT INTO EMPREGADOS (RG, NOM, CPT, SEX, COD, CPF, DPT_COD) 
	VALUES (
		2525822680, 'Maria Eduarda', 'CPT 2', 'F', 2, 06158725580, 
		(SELECT COD FROM DEPARTAMENTOS ORDER BY random() limit 1)
	);
	INSERT INTO EMPREGADOS (RG, NOM, CPT, SEX, COD, CPF, DPT_COD) 
	VALUES (
		3525822680, 'Maria Joana', 'CPT 3', 'F', 3, 07158725580,
		(SELECT COD FROM DEPARTAMENTOS ORDER BY random() limit 1)
	);
COMMIT;

BEGIN;
	INSERT INTO DEPENDENTES VALUES (to_date('14/05/1992', 'DD/MM/YYYY'), 'Cristina At', 'F', (SELECT COD FROM EMPREGADOS ORDER BY random() limit 1));
	INSERT INTO DEPENDENTES VALUES (to_date('14/05/1993', 'DD/MM/YYYY'), 'Vitor B', 'M', (SELECT COD FROM EMPREGADOS ORDER BY random() limit 1));
	INSERT INTO DEPENDENTES VALUES (to_date('14/06/1998', 'DD/MM/YYYY'), 'Georgeo R', 'M', (SELECT COD FROM EMPREGADOS ORDER BY random() limit 1));
COMMIT;

BEGIN;
	INSERT INTO ENDERECOS (COM, NUM, COD, EMP_COD, CEP_COD) VALUES ('COM 1', 32, 1, (SELECT COD FROM EMPREGADOS ORDER BY random() limit 1), (SELECT CEP FROM CEP ORDER BY random() limit 1));
	INSERT INTO ENDERECOS VALUES ('COM 1', 33, 2, (SELECT COD FROM EMPREGADOS ORDER BY random() limit 1), (SELECT CEP FROM CEP ORDER BY random() limit 1));
	INSERT INTO ENDERECOS VALUES ('COM 1', 34, 3, (SELECT COD FROM EMPREGADOS ORDER BY random() limit 1), (SELECT CEP FROM CEP ORDER BY random() limit 1));
COMMIT;

BEGIN;
	INSERT INTO TIPOTELEFONES VALUES (1, 'Movel');
	INSERT INTO TIPOTELEFONES VALUES (2, 'Fixo');
	INSERT INTO TIPOTELEFONES VALUES (3, 'Comercial');
COMMIT;

BEGIN;
	INSERT INTO TELEFONES (ID, NUM, EMP_COD, TTEL_COD, AREA_DDD) VALUES (1, '91664121', (SELECT COD FROM EMPREGADOS ORDER BY random() limit 1), 1, (SELECT DDD FROM AREAS ORDER BY random() limit 1));
	INSERT INTO TELEFONES (ID, NUM, EMP_COD, TTEL_COD, AREA_DDD) VALUES (2, '91664121', (SELECT COD FROM EMPREGADOS ORDER BY random() limit 1), 2, (SELECT DDD FROM AREAS ORDER BY random() limit 1));
COMMIT;

BEGIN;
	INSERT INTO PROJETOS VALUES ('Projeto de banco de dados 1', 'RES 1', 1, 1);
	INSERT INTO PROJETOS VALUES ('Projeto de Analise Numerica', 'RES 2', 2, 2);
	INSERT INTO PROJETOS VALUES ('Proejto de Software Básico', 'RES 3', 3, 2);
COMMIT;

BEGIN;
	INSERT INTO EMPREGADOS_PROJETOS (EMP_COD, PRJ_COD) VALUES ((SELECT COD FROM EMPREGADOS ORDER BY random() limit 1), (SELECT COD FROM PROJETOS ORDER BY random() limit 1));
	INSERT INTO EMPREGADOS_PROJETOS (EMP_COD, PRJ_COD) VALUES ((SELECT COD FROM EMPREGADOS ORDER BY random() limit 1), (SELECT COD FROM PROJETOS ORDER BY random() limit 1));
	INSERT INTO EMPREGADOS_PROJETOS (EMP_COD, PRJ_COD) VALUES ((SELECT COD FROM EMPREGADOS ORDER BY random() limit 1), (SELECT COD FROM PROJETOS ORDER BY random() limit 1));
	INSERT INTO EMPREGADOS_PROJETOS (EMP_COD, PRJ_COD) VALUES ((SELECT COD FROM EMPREGADOS ORDER BY random() limit 1), (SELECT COD FROM PROJETOS ORDER BY random() limit 1));
	INSERT INTO EMPREGADOS_PROJETOS (EMP_COD, PRJ_COD) VALUES ((SELECT COD FROM EMPREGADOS ORDER BY random() limit 1), (SELECT COD FROM PROJETOS ORDER BY random() limit 1));
	INSERT INTO EMPREGADOS_PROJETOS (EMP_COD, PRJ_COD) VALUES ((SELECT COD FROM EMPREGADOS ORDER BY random() limit 1), (SELECT COD FROM PROJETOS ORDER BY random() limit 1));
	INSERT INTO EMPREGADOS_PROJETOS (EMP_COD, PRJ_COD) VALUES ((SELECT COD FROM EMPREGADOS ORDER BY random() limit 1), (SELECT COD FROM PROJETOS ORDER BY random() limit 1));
COMMIT;

BEGIN;
	INSERT INTO CIDADES_PROJETOS VALUES ((SELECT cod FROM cidade ORDER BY random() limit 1), 1);
COMMIT;

-- UPDATES

UPDATE DEPARTAMENTOS
SET EMP_COD = (SELECT COD FROM EMPREGADOS ORDER BY random() limit 1)
WHERE COD = (SELECT COD FROM DEPARTAMENTOS WHERE EMP_COD is NULL ORDER BY random() limit 1);

UPDATE DEPARTAMENTOS
SET EMP_COD = (SELECT COD FROM EMPREGADOS ORDER BY random() limit 1)
WHERE COD = (SELECT COD FROM DEPARTAMENTOS WHERE EMP_COD is NULL ORDER BY random() limit 1);

UPDATE DEPARTAMENTOS
SET EMP_COD = (SELECT COD FROM EMPREGADOS ORDER BY random() limit 1)
WHERE COD = (SELECT COD FROM DEPARTAMENTOS WHERE EMP_COD is NULL ORDER BY random() limit 1);

UPDATE EMPREGADOS 
SET EMP_COD = (SELECT COD FROM EMPREGADOS ORDER BY random() limit 1)
WHERE COD = (SELECT COD FROM EMPREGADOS WHERE EMP_COD is NULL ORDER BY random() limit 1);

UPDATE EMPREGADOS 
SET EMP_COD = (SELECT COD FROM EMPREGADOS ORDER BY random() limit 1)
WHERE COD = (SELECT COD FROM EMPREGADOS WHERE EMP_COD is NULL ORDER BY random() limit 1);

UPDATE EMPREGADOS 
SET EMP_COD = (SELECT COD FROM EMPREGADOS ORDER BY random() limit 1)
WHERE COD = (SELECT COD FROM EMPREGADOS WHERE EMP_COD is NULL ORDER BY random() limit 1);


-- GET EMPREGADO BY ID
SELECT * FROM EMPREGADOS WHERE COD = (SELECT COD FROM EMPREGADOS ORDER BY random() limit 1);
---- WITH CONTACT INFO
SELECT * FROM EMPREGADOS LEFT JOIN TELEFONES ON (EMPREGADOS.COD = TELEFONES.EMP_COD) WHERE EMPREGADOS.COD = (SELECT COD FROM EMPREGADOS ORDER BY random() limit 1);
---- WITH DEPARTAMENTO INFO
SELECT * FROM EMPREGADOS LEFT JOIN DEPARTAMENTOS ON (EMPREGADOS.DPT_COD = DEPARTAMENTOS.COD) WHERE EMPREGADOS.COD = (SELECT COD FROM EMPREGADOS ORDER BY random() limit 1);
-- GET PROJETO BY EMPREGADO ID 
SELECT * FROM EMPREGADOS_PROJETOS LEFT JOIN PROJETOS ON(EMPREGADOS_PROJETOS.PRJ_COD = PROJETOS.COD) LEFT JOIN EMPREGADOS ON (EMPREGADOS_PROJETOS.EMP_COD = EMPREGADOS.COD) WHERE EMPREGADOS_PROJETOS.EMP_COD = (SELECT COD FROM EMPREGADOS ORDER BY random() limit 1);
-- GET ENDERECO BY EMPREGADO ID 
SELECT * FROM ENDERECOS LEFT JOIN CEP ON (ENDERECOS.CEP_COD = CEP.CEP) LEFT JOIN EMPREGADOS ON (ENDERECOS.EMP_COD = EMPREGADOS.COD) WHERE ENDERECOS.EMP_COD = (SELECT COD FROM EMPREGADOS ORDER BY random() limit 1); 
-- GET DEPENDENTES BY EMPREGADO ID 
SELECT * FROM DEPENDENTES WHERE EMP_COD = (SELECT EMP_COD FROM DEPENDENTES ORDER BY random() limit 1); 
